<?xml version="1.0" encoding="UTF-8"?>
<!--
    Information schema for Libgda's dictionary DB.
    This is the base schema and can be extended by applications by adding new
    DBMS objects, but: the '_' prefix is reserved for Libgda's internals...
-->


<schema>
  <!-- provider specific information 
       use <replace> to replace something with something else (context can only be "/FIELDS_A/@COLUMN_TYPE" at the moment)
       use <ignore> to ignore some parts (context can only be "/FKEY_S" or "/FIELDS_A/@COLUMN_PKEY" at the moment)
    -->
  <specifics>
    <provider name="PostgreSQL">
      <replace context="/FIELDS_A/@COLUMN_TYPE" expr="string" replace_with="varchar"/>
      <replace context="/FIELDS_A/@COLUMN_TYPE" expr="gint" replace_with="int"/>
    </provider>
    <provider name="MySQL">
      <replace context="/FIELDS_A/@COLUMN_TYPE" expr="string" replace_with="text"/>
      <replace context="/FIELDS_A/@COLUMN_TYPE" expr="gint" replace_with="int"/>
      <ignore context="/FKEY_S"/>
      <ignore context="/FIELDS_A/@COLUMN_PKEY"/>
    </provider>
    <provider name="SQLite">
      <replace context="/FIELDS_A/@COLUMN_TYPE" expr="gint" replace_with="int"/>
    </provider>
  </specifics>

  <!-- schema description -->
  <table name="_attributes" descr="(key,value) pairs, keys starting with '_' are reserved">
    <column name="att_name" pkey="TRUE"/>
    <column name="att_value"/>
  </table>

  <table name="_information_schema_catalog_name" descr="One row: the name of the current database (current catalog)">
    <column name="catalog_name" pkey="TRUE"/>
  </table>

  <table name="_schemata" descr="List of schemas">
    <column name="catalog_name" pkey="TRUE"/>
    <column name="schema_name" pkey="TRUE"/>
    <column name="schema_owner" nullok="TRUE"/>
    <column name="schema_internal" type="boolean"/>
    <fkey ref_table="_information_schema_catalog_name">
      <part column="catalog_name" ref_column="catalog_name"/>
    </fkey>
  </table>

  <table name="_builtin_data_types" descr="List of built-in data types such as varchar, int, ...">
    <column name="short_type_name"/>
    <column name="full_type_name" pkey="TRUE"/>
    <column name="gtype" nullok="TRUE"/>
    <column name="comments" nullok="TRUE"/>
    <column name="synonyms" nullok="TRUE"/>
    <column name="internal" type="boolean"/>
    <unique>
      <column name="short_type_name"/>
    </unique>
  </table>

  <table name="_udt" descr="User defined data types">
    <column name="udt_catalog" pkey="TRUE"/>
    <column name="udt_schema" pkey="TRUE"/>
    <column name="udt_name" pkey="TRUE"/>
    <column name="udt_gtype" nullok="TRUE"/>
    <column name="udt_comments" nullok="TRUE"/>
    <column name="udt_short_name"/>
    <column name="udt_full_name"/>
    <column name="udt_internal" type="boolean"/>
    <column name="udt_owner" nullok="TRUE"/>
    <fkey ref_table="_schemata">
      <part column="udt_catalog" ref_column="catalog_name"/>
      <part column="udt_schema" ref_column="schema_name"/>
    </fkey>
    <unique>
      <column name="udt_full_name"/>
    </unique>
  </table>

  <table name="_udt_columns" descr="List of components for a user defined data type">
    <column name="udt_catalog" pkey="TRUE"/>
    <column name="udt_schema" pkey="TRUE"/>
    <column name="udt_name" pkey="TRUE"/>
    <column name="udt_column" pkey="TRUE"/>
    <column name="ordinal_position" type="gint" descr="Column position, starts at 1"/>
    <column name="data_type" descr="References _all_types.full_type_name or _element_types.specific_name"/>
    <column name="character_maximum_length" type="gint" nullok="TRUE"/>
    <column name="character_octet_length" type="gint" nullok="TRUE"/>
    <column name="numeric_precision" type="gint" nullok="TRUE"/>
    <column name="numeric_scale" type="gint" nullok="TRUE"/>
    <column name="datetime_precision" type="gint" nullok="TRUE"/>
    <column name="character_set_catalog" nullok="TRUE"/>
    <column name="character_set_schema" nullok="TRUE"/>
    <column name="character_set_name" nullok="TRUE"/>
    <column name="collation_catalog" nullok="TRUE"/>
    <column name="collation_schema" nullok="TRUE"/>
    <column name="collation_name" nullok="TRUE"/>
    <fkey ref_table="_udt">
      <part column="udt_catalog"/>
      <part column="udt_schema"/>
      <part column="udt_name"/>
    </fkey>
  </table>

  <table name="_enums" descr="List of possible enumeration labels for enumerations">
    <column name="udt_catalog" pkey="TRUE"/>
    <column name="udt_schema" pkey="TRUE"/>
    <column name="udt_name" pkey="TRUE"/>
    <column name="label" pkey="TRUE"/>
    <column name="ordinal_position" type="gint" descr="Position, starts at 1"/>
    <fkey ref_table="_udt">
      <part column="udt_catalog"/>
      <part column="udt_schema"/>
      <part column="udt_name"/>
    </fkey>
  </table>

  <table name="_element_types" descr="">
    <column name="specific_name" pkey="TRUE"/>
    <column name="object_catalog"/>
    <column name="object_schema"/>
    <column name="object_name"/>
    <column name="object_ordinal_position" type="gint" nullok="TRUE"/>
    <column name="object_type"/>
    <column name="data_type"/>
    <column name="min_cardinality" type="gint"/>
    <column name="max_cardinality" type="gint"/>
  </table>

  <table name="_domains" descr="List of domains">
    <column name="domain_catalog" pkey="TRUE"/>
    <column name="domain_schema" pkey="TRUE"/>
    <column name="domain_name" pkey="TRUE"/>
    <column name="data_type" nullok="TRUE"/>
    <column name="gtype"/>
    <column name="character_maximum_length" type="gint" nullok="TRUE"/>
    <column name="character_octet_length" type="gint" nullok="TRUE"/>
    <column name="collation_catalog" nullok="TRUE"/>
    <column name="collation_schema" nullok="TRUE"/>
    <column name="collation_name" nullok="TRUE"/>
    <column name="character_set_catalog" nullok="TRUE"/>
    <column name="character_set_schema" nullok="TRUE"/>
    <column name="character_set_name" nullok="TRUE"/>
    <column name="numeric_precision" type="gint" nullok="TRUE"/>
    <column name="numeric_scale" type="gint" nullok="TRUE"/>
    <column name="domain_default" nullok="TRUE"/>
    <column name="domain_comments" nullok="TRUE"/>
    <column name="domain_short_name"/>
    <column name="domain_full_name"/>
    <column name="domain_internal" type="boolean"/>
    <column name="domain_owner" nullok="TRUE"/>
    <fkey ref_table="_schemata">
      <part column="domain_catalog" ref_column="catalog_name"/>
      <part column="domain_schema" ref_column="schema_name"/>
    </fkey>
    <unique>
      <column name="domain_full_name"/>
    </unique>
  </table>

  <table name="_tables">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="table_type"/>
    <column name="is_insertable_into" type="boolean" nullok="TRUE"/>
    <column name="table_comments" nullok="TRUE"/>
    <column name="table_short_name"/>
    <column name="table_full_name"/>
    <column name="table_owner" nullok="TRUE"/>
    <fkey ref_table="_schemata">
      <part column="table_catalog" ref_column="catalog_name"/>
      <part column="table_schema" ref_column="schema_name"/>
    </fkey>
    <unique>
      <column name="domain_full_name"/>
    </unique>
  </table>

  <table name="_views">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="view_definition" nullok="TRUE"/>
    <column name="check_option" nullok="TRUE" descr="CASCADE if the statement used to create the view included the WITH CHECK OPTION; otherwise, NONE"/>
    <column name="is_updatable" type="boolean" nullok="TRUE"/>
    <fkey ref_table="_tables">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
    </fkey>
  </table>

  <table name="_collations">
    <column name="collation_catalog" pkey="TRUE"/>
    <column name="collation_schema" pkey="TRUE"/>
    <column name="collation_name" pkey="TRUE"/>
    <column name="collation_comments" nullok="TRUE"/>
    <column name="collation_short_name"/>
    <column name="collation_full_name"/>
    <fkey ref_table="_schemata">
      <part column="collation_catalog" ref_column="catalog_name"/>
      <part column="collation_schema" ref_column="schema_name"/>
    </fkey>
    <unique>
      <column name="collation_full_name"/>
    </unique>
  </table>

  <table name="_character_sets">
    <column name="character_set_catalog" pkey="TRUE"/>
    <column name="character_set_schema" pkey="TRUE"/>
    <column name="character_set_name" pkey="TRUE"/>
    <column name="default_collate_catalog" nullok="TRUE"/>
    <column name="default_collate_schema" nullok="TRUE"/>
    <column name="default_collate_name" nullok="TRUE"/>
    <column name="character_set_comments" nullok="TRUE"/>
    <column name="character_set_short_name"/>
    <column name="character_set_full_name"/>
    <fkey ref_table="_schemata">
      <part column="character_set_catalog" ref_column="catalog_name"/>
      <part column="character_set_schema" ref_column="schema_name"/>
    </fkey>
    <fkey ref_table="_collations">
      <part column="default_collate_catalog" ref_column="collation_catalog"/>
      <part column="default_collate_schema" ref_column="collation_schema"/>
      <part column="default_collate_name" ref_column="collation_name"/>
    </fkey>
    <unique>
      <column name="character_set_full_name"/>
    </unique>
  </table>

  <table name="_routines">
    <column name="specific_catalog" pkey="TRUE"/>
    <column name="specific_schema" pkey="TRUE"/>
    <column name="specific_name" pkey="TRUE"/>
    <column name="routine_catalog" nullok="TRUE"/>
    <column name="routine_schema" nullok="TRUE"/>
    <column name="routine_name"/>
    <column name="routine_type" nullok="TRUE"/>
    <column name="return_type" nullok="TRUE"/>
    <column name="returns_set" type="boolean"/>
    <column name="routine_body" nullok="TRUE"/>
    <column name="routine_definition" nullok="TRUE"/>
    <column name="external_name" nullok="TRUE"/>
    <column name="external_language" nullok="TRUE"/>
    <column name="parameter_style" nullok="TRUE"/>
    <column name="is_deterministic" type="boolean" nullok="TRUE"/>
    <column name="sql_data_access" nullok="TRUE"/>
    <column name="is_null_call" type="boolean" nullok="TRUE"/>
    <column name="routine_comments" nullok="TRUE"/>
    <column name="routine_short_name"/>
    <column name="routine_full_name"/>
    <column name="routine_owner" nullok="TRUE"/>
    <fkey ref_table="_schemata">
      <part column="specific_catalog" ref_column="catalog_name"/>
      <part column="specific_schema" ref_column="schema_name"/>
    </fkey>
    <unique>
      <column name="routine_full_name"/>
    </unique>
  </table>

  <table name="_triggers">
    <column name="trigger_catalog" pkey="TRUE"/>
    <column name="trigger_schema" pkey="TRUE"/>
    <column name="trigger_name" pkey="TRUE"/>
    <column name="event_manipulation" pkey="TRUE"/>
    <column name="event_object_catalog" pkey="TRUE"/>
    <column name="event_object_schema" pkey="TRUE"/>
    <column name="event_object_table" pkey="TRUE"/>
    <column name="action_statement" nullok="TRUE"/>
    <column name="action_orientation"/>
    <column name="condition_timing"/>
    <column name="trigger_comments" nullok="TRUE"/>
    <column name="trigger_short_name"/>
    <column name="trigger_full_name"/>
    <fkey ref_table="_schemata">
      <part column="trigger_catalog" ref_column="catalog_name"/>
      <part column="trigger_schema" ref_column="schema_name"/>
    </fkey>
    <fkey ref_table="_tables">
      <part column="event_object_catalog" ref_column="table_catalog"/>
      <part column="event_object_schema" ref_column="table_schema"/>
      <part column="event_object_table" ref_column="table_name"/>
    </fkey>
    <unique>
      <column name="trigger_full_name"/>
    </unique>
  </table>

  <table name="_columns">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="column_name" pkey="TRUE"/>
    <column name="ordinal_position" type="gint" descr="Column position, starts at 1"/>
    <column name="column_default" nullok="TRUE"/>
    <column name="is_nullable" type="boolean"/>
    <column name="data_type" descr="References _all_types.full_type_name"/>
    <column name="array_dimension" type="gint"/>
    <column name="element_type" nullok="TRUE" descr="References _element_types.specific_name, for arrays of @data_type base type"/>
    <column name="gtype"/>
    <column name="character_maximum_length" type="gint" nullok="TRUE"/>
    <column name="character_octet_length" type="gint" nullok="TRUE"/>
    <column name="numeric_precision" type="gint" nullok="TRUE"/>
    <column name="numeric_scale" type="gint" nullok="TRUE"/>
    <column name="datetime_precision" type="gint" nullok="TRUE"/>
    <column name="character_set_catalog" nullok="TRUE"/>
    <column name="character_set_schema" nullok="TRUE"/>
    <column name="character_set_name" nullok="TRUE"/>
    <column name="collation_catalog" nullok="TRUE"/>
    <column name="collation_schema" nullok="TRUE"/>
    <column name="collation_name" nullok="TRUE"/>
    <column name="extra" nullok="TRUE" descr="CSV string with: AUTO_INCREMENT"/>
    <column name="is_updatable" type="boolean" nullok="TRUE"/>
    <column name="column_comments" nullok="TRUE"/>
    <fkey ref_table="_tables">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
    </fkey>
    <fkey ref_table="_character_sets">
      <part column="character_set_catalog"/>
      <part column="character_set_schema"/>
      <part column="character_set_name"/>
    </fkey>
    <fkey ref_table="_collations">
      <part column="collation_catalog"/>
      <part column="collation_schema"/>
      <part column="collation_name"/>
    </fkey>
  </table>

  <table name="_table_constraints">
    <column name="constraint_catalog" nullok="TRUE" descr="Name of the catalog that contains the constraint"/>
    <column name="constraint_schema" nullok="TRUE" descr="Name of the schema that contains the constraint"/>

    <column name="constraint_name" pkey="TRUE"/>
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="constraint_type" descr="CHECK, FOREIGN KEY, PRIMARY KEY or UNIQUE"/>
    <column name="check_clause" nullok="TRUE" descr="The check expression if the constraint is a check constraint, NULL otherwise"/>
    <column name="is_deferrable" type="boolean" nullok="TRUE"/>
    <column name="initially_deferred" type="boolean" nullok="TRUE"/>
    <fkey ref_table="_tables">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
    </fkey>
  </table>

  <table name="_referential_constraints">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="constraint_name" pkey="TRUE"/>

    <column name="ref_table_catalog"/>
    <column name="ref_table_schema"/>
    <column name="ref_table_name"/>
    <column name="ref_constraint_name"/>

    <column name="match_option" nullok="TRUE" descr="FULL, PARTIAL or NONE"/>
    <column name="update_rule" nullok="TRUE" descr="CASCADE, SET NULL, SET DEFAULT, RESTRICT, NO ACTION or NONE"/>
    <column name="delete_rule" nullok="TRUE" descr="CASCADE, SET NULL, SET DEFAULT, RESTRICT, NO ACTION or NONE"/>
    <fkey ref_table="_table_constraints">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="constraint_name"/>
    </fkey>
    <fkey ref_table="_table_constraints">
      <part column="ref_table_catalog" ref_column="table_catalog"/>
      <part column="ref_table_schema" ref_column="table_schema"/>
      <part column="ref_table_name" ref_column="table_name"/>
      <part column="ref_constraint_name" ref_column="constraint_name"/>
    </fkey>
  </table>

  <table name="_key_column_usage">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="constraint_name" pkey="TRUE"/>
    <column name="column_name" pkey="TRUE"/>

    <column name="ordinal_position" type="gint" pkey="TRUE"/>
    <fkey ref_table="_table_constraints">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="constraint_name"/>
    </fkey>
    <fkey ref_table="_columns">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="column_name"/>
    </fkey>
  </table>

  <table name="_check_column_usage">
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="constraint_name" pkey="TRUE"/>
    <column name="column_name" pkey="TRUE"/>
    <fkey ref_table="_table_constraints">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="constraint_name"/>
    </fkey>
    <fkey ref_table="_columns">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="column_name"/>
    </fkey>
  </table>

  <table name="_view_column_usage">
    <column name="view_catalog" pkey="TRUE"/>
    <column name="view_schema" pkey="TRUE"/>
    <column name="view_name" pkey="TRUE"/>
    <column name="table_catalog" pkey="TRUE"/>
    <column name="table_schema" pkey="TRUE"/>
    <column name="table_name" pkey="TRUE"/>
    <column name="column_name" pkey="TRUE"/>
    <fkey ref_table="_views">
      <part column="view_catalog" ref_column="table_catalog"/>
      <part column="view_schema" ref_column="table_schema"/>
      <part column="view_name" ref_column="table_name"/>
    </fkey>
    <fkey ref_table="_columns">
      <part column="table_catalog"/>
      <part column="table_schema"/>
      <part column="table_name"/>
      <part column="column_name"/>
    </fkey>
  </table>

  <table name="_domain_constraints">
    <column name="constraint_catalog" nullok="TRUE" descr="Name of the catalog that contains the constraint"/>
    <column name="constraint_schema" nullok="TRUE" descr="Name of the schema that contains the constraint"/>

    <column name="constraint_name" pkey="TRUE"/>
    <column name="domain_catalog" pkey="TRUE"/>
    <column name="domain_schema" pkey="TRUE"/>
    <column name="domain_name" pkey="TRUE"/>

    <column name="check_clause" nullok="TRUE"/>
    <column name="is_deferrable" type="boolean" nullok="TRUE"/>
    <column name="initially_deferred" type="boolean" nullok="TRUE"/>
    <fkey ref_table="_domains">
      <part column="domain_catalog"/>
      <part column="domain_schema"/>
      <part column="domain_name"/>
    </fkey>
    <fkey ref_table="_schemata">
      <part column="constraint_catalog" ref_column="catalog_name"/>
      <part column="constraint_schema"  ref_column="schema_name"/>
    </fkey>
  </table>

  <table name="_parameters">
    <column name="specific_catalog" pkey="TRUE"/>
    <column name="specific_schema" pkey="TRUE"/>
    <column name="specific_name" pkey="TRUE"/>
    <column name="ordinal_position" type="gint" pkey="TRUE"/>
    <column name="parameter_mode"/>
    <column name="parameter_name" nullok="TRUE"/>
    <column name="data_type"/>
    <fkey ref_table="_routines">
      <part column="specific_catalog"/>
      <part column="specific_schema"/>
      <part column="specific_name"/>
    </fkey>
  </table>

  <table name="_routine_columns">
    <column name="specific_catalog" pkey="TRUE"/>
    <column name="specific_schema" pkey="TRUE"/>
    <column name="specific_name" pkey="TRUE"/>
    <column name="column_name" pkey="TRUE"/>
    <column name="ordinal_position" type="gint" nullok="TRUE" pkey="TRUE"/>
    <column name="data_type"/>
    <fkey ref_table="_routines">
      <part column="specific_catalog"/>
      <part column="specific_schema"/>
      <part column="specific_name"/>
    </fkey>
  </table>
  
  <view name="_all_types">
    <definition>SELECT short_type_name AS short_type_name, gtype, full_type_name AS full_type_name, comments, internal AS internal, synonyms,
       NULL AS domain_catalog, NULL AS domain_schema, NULL AS domain_name,
       NULL AS udt_catalog, NULL AS udt_schema, NULL AS udt_name
       FROM _builtin_data_types
UNION
SELECT udt_short_name, udt_gtype, udt_full_name, udt_comments, udt_internal, NULL,
       NULL, NULL, NULL, udt_catalog, udt_schema, udt_name FROM _udt
UNION
SELECT domain_short_name, domain_gtype, domain_full_name, domain_comments, domain_internal, NULL,
       domain_catalog, domain_schema, domain_name , NULL, NULL, NULL FROM _domains</definition>
  </view>

  <view name="_detailled_fk">
    <definition>SELECT rc.table_catalog as fk_table_catalog, rc.table_schema as fk_table_schema, rc.table_name as fk_table_name, kc1.column_name as fk_column,
      rc.ref_table_catalog as ref_table_catalog, rc.ref_table_schema as ref_table_schema, rc.ref_table_name as ref_table_name, kc2.column_name as ref_column,
      rc.constraint_name as fk_constraint_name, kc1.ordinal_position as ordinal_position
      FROM _referential_constraints rc 
      INNER JOIN _key_column_usage kc2 ON (rc.ref_table_catalog=kc2.table_catalog AND rc.ref_table_schema=kc2.table_schema AND rc.ref_table_name=kc2.table_name AND rc.ref_constraint_name=kc2.constraint_name) 
      INNER JOIN _key_column_usage kc1 ON (rc.table_catalog=kc1.table_catalog AND rc.table_schema=kc1.table_schema AND rc.table_name=kc1.table_name AND rc.constraint_name=kc1.constraint_name) 
      WHERE kc1.ordinal_position = kc2.ordinal_position 
      ORDER BY rc.table_catalog, rc.table_schema, rc.table_name, kc1.ordinal_position
    </definition>
  </view>

</schema>
